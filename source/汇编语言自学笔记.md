---
title: 汇编语言自学笔记
date: 2019-06-07 20:41:05
tags:
- 学习笔记
- 汇编语言
categories:
- 理论基础
---

记录一下学习过程，以后遗忘了也方便复习。
学习方法：[b站视频](https://www.bilibili.com/video/av34455803) + 汇编语言教材（王爽第3版），视频中用到的工具在 [百度网盘](https://pan.baidu.com/s/1EfNaQOxSYfYg8V5KZFQahw) (提取码: 7evz)中。

---
#  预备

##  1  相关软件的安装


主要是用到了DOSbox和Vim，工具都在网盘中。
**配置DOSbox**

1. 在D盘中新建一个asm的文件夹，以后在这个文件夹中建立文件练习；
2. 将网盘中的debug.exe放在asm文件夹下；
3. 运行DOSbox安装程序（在网盘中），一直next即可；
4. 找到安装目录C:\Users\Administrator\AppData\Local\DOSBox，编辑配置文件，在最下面添加mount c: d:\asm  和 c:，如下图；这样每次开启软件就可以自动运行命令进入目录，不用手动输入了； 
5. 运行DOSbox，键入debug，再键入d，就可以使用了。



![](/img/17108100-3fe1d1dfc3e6561d.png)

**配置Vim**

1. 安装Vim，一直next就好；
2. 找到安装目录，C:\Program Files (x86)\Vim，编辑配置文件，加入
> color evening
> set nu

调成黑色背景并显示行号。
**编译小练习**

1. 将网盘中的LINK.exe，MASM.exe，temp.txt，temp1.txt拷贝至asm文件夹内，并新建t1.asm把temp.txt中的内容复制进去；
2. 进入DOSbox配置文件，在底部加入
> masm t1;				
> link t1;

3. 打开DOSbox，即可自动完成编译和连接，asm文件夹内会出出现t1.obj和t1.exe;
4. 在DOSbox中键入t1，发现屏幕中出现紫色小区域，表示exe运行成功。

![](/img/17108100-cda2990655ee2626.png)

<hr/>
##  2  关于编码

**编码是人类表示世界的方式**
希腊人是如何用地图表示世界地理位置的？
用纬度和经度表示。
人类是如何表示长度的？
有各种单位，如米、厘米、英寸.......
人类是如何表示时间的?
年、月、日、时、分、秒.......
人类是如何表示天上的星星的？
有各种星座，金牛座、处女座、猎户座，即用图形表示星星之间的相对位置。
以上各种，都是一种编码系统，都是人类对世界的表示。

又如我们是如何表示我们说话时所发出的声波的？拼音字母a、o、e就是对我们发出的声波的一种表示，对于英语来讲，英语是由音节组成并与读音相对应，也是一种对人类发出声波的一种编码。
再一个例子，笛卡尔坐标系，本质上也是一套编码/表示系统，用于表示坐标系中的任意一点。
**世界与计算与计算要素**
人类为了观测世界，用编码对世界进行表示，用数学对世界进行描述（计算），
即 找到计算要素→对计算要素进行表示→计算
一个简单的例子：
问：你给了我一个苹果，然后又给了我两个苹果，请问我得到了几个苹果？
解：①找到其中的计算要素：一个苹果、两个苹果；②用逻辑符号表示计算要素之间的关系；③进行计算，即1+2=3。
总结一下，就是用逻辑表示系统，将计算要素与计算要素之间的逻辑关系表示出来进行计算，所有的学科皆是如此。
那就有人问了，你说所有的学科皆是如此，那历史呢，历史也需要这个样吗？
这就要拓宽对``计算``的理解：举一个历史中的例子，比如说一场战役，双方需要把天气、地形以及敌军情况这些计算要素找出来，然后据此制定作战计划进行计算。再比如说心理测试，就是通过收集计算要素，再用计算推断出受测者的心理状态。
``这一切都是可以计算的。``
**计算要素与表示系统**
还是上面的苹果例子。解决这个问题我们可以用阿拉伯数字，也可以用算盘，甚至可以结绳计数，当然效率是有差别的，即``一套好的表示系统，可以更好的表示出计算要素以及计算要素与计算要素之间的逻辑关系。``
**计算机编程语言是一套什么系统？**
答案很明显，是一套表示系统。
英语是一种语言，汉语也是一种语言，语言是用来互相交流的，我们之间正是由于采用了同一套表示/编码系统，才能理解彼此的意思。
计算机编程语言也是用来人与计算机相互交流的。
python、java、c++是高级编程语言，而汇编语言是低级编程语言。

汇编语言虽然使用不便，但是它提供了一种观测手段，可以观测到很多高级语言无法观测到的东西。             
<hr/>
##  3  二进制、十进制与十六进制

这个就记录几个要点。
二进制由一和零组成，1代表有，0代表无。
二进制与十进制的快速转换：比如十进制数35，可以拆成32+2+1，把相应的二进数位变为1，得到二进制数10011。
十六进制与十进制快速转换：比如十进制数83可以表示为16×5 + 3，表示成十六进制为53H（H是后缀，表示该数为十六进制hex），注意在十六进制中，1有0无规则失效。
十六进制与二进制快速转换：用4位二进制代表一位十六进制即可，比如2A，2用二进制表示就是0010，A用二进制表示就是1010，所以2A用二进制表示为00101010。

为什么4个二进制位可以表示一个16进制？

个人理解：对于二进制，每左移一位可以视作值乘以2，左移4位就代表乘以16，所以00101010中的0010就代表它本身的值2乘以16，也就相当于16进制的第二位。之后的依此类推。

**反过来思考**
4位二进制数最高表示15，即1111。根据1有0无的规则，转换时剪掉0所对应的数就能得到十进制数。比如，1101，代表第二位缺失，那它就表示15-2=13

<hr/>
#   第一章 基础知识

仅记录一些要点
**汇编语言由什么组成？**

- 汇编指令
- 伪指令：帮助编译器把汇编语言翻译成机器语言，伪指令自身并不被翻译，它没有对应的机器码
- 其它符号：如+、-、*、/等，也没有对应的机器码

**DOSBOX的一些指令**
-debug -u -d
u指令和d指令的解释不同，u指令我们看到的是机器指令和汇编指令，d指令我们看到是数据。

**总线**
- 地址总线：决定cpu的寻址能力；如果一个cpu有N个地址线，则可以说这个cpu的地址总线的宽度为N。这样的cpu最多可以寻找2的N次方个内存单元。这里的内存单元应该指的是一个字节，即8个二进制位。
- 数据总线：决定cpu和其它部件进行数据传送时一次性能够传送多少字节的能力，8根数据总线一次可传送8位二进制数（一个字节），16根数据总线一次性可传送两个字节。
- 控制总线：决定了cpu对其他部件的控制能力。

**检测点1.1**
（1）一个CPU的寻址能力为8KB，那么它的地址总线的宽度为__________________:

$ 8KB=2^{3}\times 2^{10}B=2^{13}B $，所以地址总线宽度为13。

其余略。
**接口**

RAM：允许读写，断电清空；ROM：只需读取，断电不清空。

每一台PC都有一个主板，上面有核心器件和主要器件，这些器件通过总线相连。这些器件有cpu、存储器、外围芯片组、扩展插槽等。扩展插槽上一般都有RAM内存条和各类接口卡。

计算机系统中，所有可用程序控制其工作的设备，必须受到cpu的控制。cpu对外部设备不能控制，如显示器、打印机、音响等。直接控制这些设备的是插在扩展插槽上的接口卡，cpu通过接口卡间接控制这些设备。
**存储器芯片** 

- 随机存储器，用于存放供cpu使用的绝大部分程序和数据。主要由装在主板上的RAM和插在扩展插槽上的RAM组成。

- 装有BIOS（Basic Input/Outpu System 基本输入输出系统）的ROM。

  BIOS是由主板和各类接口卡厂商提供的软件系统，可以通过它进行基本的输入输出。主板的ROM上存放着主板的BIOS（又称为系统BIOS），显卡的ROM上存放着显卡的BIOS等等。

- 接口卡上的RAM：对输入输出的数据进行临时存储。

![](/img/微信截图_20190625154442.png)
**内存地址空间** 

对cpu来讲，系统中的所有存储器中的存储单元都处于一个统一的一个逻辑存储器中，它的容量受到cpu寻址能力的限制。这个逻辑存储器即是我们所说的内存地址空间。

![](/img/微信截图_20190625154839.png)

<hr/>
#  第二章 寄存器

主要研究对象是8086CPU，共有14个寄存器，都是16位，存放两个字节

## 2.1 通用寄存器

AX、BX、CX、DX用来存放一般性数据，故称为通用寄存器

为了兼容，这4个寄存器都可以分为两个独立的8位寄存器使用

AX = AH + AL    BX = BH + BL      CX = CH + CL       DX = DH + DL

## 2.2 字在寄存器中的存储

8086CPU可以一次性处理两种尺寸数据：8位的字节byte和16位的字word

## 2.3 几条汇编指令

明白mov、add的作用

运算结果超过寄存器存储的上限后，最高位不会保存在寄存器（保存到了其它地方）中，可以用DOSBox进行实验：

1. 进入debug模式
2. 按a， 输入指令
3. 按t， 执行指令

注意事项：

1. DOSBox识别16进制数据
2. DOSBox会自动把输入的数据补全到与寄存器对应的位数，如果输入的数据超过了寄存器的位数则报错
3. 使用寄存器进行mov、add时，位数必须一致
4. 采用通用寄存器的8位寄存器进行运算时，它本身与16位寄存器是独立的，例如使用AL运算超过了上限，进位的数据不会保存在AH中



**检测点2.1**

第一题仔细算就好，但是要看清题目，否则很容易出错

第二题思路，把2mov到一个寄存器中，然后add自身3次

## 2.4 物理地址

所有的内存单元构成的存储空间是一个一维的线性空间，每一个内存单元都有一个唯一的地址，称为物理地址

## 2.5 16位结构CPU

- 运算器一次最多可以处理16位数据
- 寄存器的最大宽度位16位
- 寄存器和运算器之间的通路为16位

## 2.6 8086CPU是如何给出物理地址的？

8086CPU有20位地址总线，寻址能理为1MB，但是一次只能传输16位数据，那怎么办呢？

方法是采用两个16位地址合成20位地址，一个是段地址，另一个是偏移地址，于是物理地址就等于段地址×16+偏移地址，乘16位就相当于2进制左移四位，就可以达到20位了

## 2.7 段地址×16+偏移地址=物理地址的本质含义

就是学校、体育馆、图书馆的那个例子

## 2.8 段的含义是什么？

段只是一个概念，实际内存并没有真正分段

一个段的起始地址是段地址×16，因此必然是16的倍数

偏移地址最大值为FFFFH，因此一个段的最大长度为64KB

一个物理地址可以用多个段地址×16+偏移地址的形式表示

## 2.9 哪些是段寄存器？

用于储存段地址：CS、DS、SS、ES

## 2.10 CS和IP

内存中保存的都是二进制数据，那么计算机怎么区分哪个是指令，哪个是数据呢？

方法是把CS:IP指向的内容当作指令

总的流程是：

1. 从CS:IP指向的内存单元中读取指令，读取的指令进入指令缓冲器
2. IP=IP+读取指令的长度，从而指向下一条指令
3. 执行指令，转向1

## 2.11 如何修改CS、IP中的指令？

采用jmp

例如 jmp 2AE3:3，执行后CS中就是2AE3H，IP中就是0003H 

或者jmp ax，执行后，IP中的值就等于ax中的值

## 2.12 代码段

我们可以把长度小于64KB的一段代码放置在起始地址为16的倍数、连续的内存单元中，然后可以将其视作为一个代码段，然后用jmp指令让CS:IP指向代码的首地址即可。

为什么长度要小于64KB呢？
个人理解：IP执行完指令后会自动增加，最多是64KB，但是CS好像不会自动增加

